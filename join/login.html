<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>로그인 - 호두마켓</title>
  <link rel="icon" type="image/svg+xml" href="../assets/images/icons/favicon.svg">
  <link rel="stylesheet" href="../assets/css/reset.css" />
  <link rel="stylesheet" href="../assets/css/common.css" />
  <link rel="stylesheet" href="../assets/css/pages/login.css" />
</head>
<body>
  <img class="logo" src="../assets/images/Logo-hodu.png" alt="로고">
  <div class="login-box">
    <div class="tabs">
      <div class="tab active" onclick="showForm('buyer')">구매회원 로그인</div>
      <div class="tab" onclick="showForm('seller')">판매회원 로그인</div>
    </div>

    <div id="buyer" class="form active">
      <input class="input" type="text" placeholder="아이디" id="buyer-id">
      <input class="input" type="password" placeholder="비밀번호" id="buyer-pw"><p class="error-msg" id="buyer-error"></p> <button class="btn" onclick="handleLogin('buyer')">로그인</button>
    </div>

    <div id="seller" class="form">
      <input class="input" type="text" placeholder="아이디" id="seller-id">
      <input class="input" type="password" placeholder="비밀번호" id="seller-pw">
      <p class="error-msg" id="seller-error"></p> <button class="btn" onclick="handleLogin('seller')">로그인</button>
    </div>
  </div>

  <div class="links">
    <a href="./signup.html" class="link-item">회원가입</a> | <span>비밀번호 찾기</span>
  </div>

  <script>
    function showForm(type) {
      document.querySelectorAll('.form').forEach(f => f.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

      document.getElementById(type).classList.add('active');

      if (type === 'buyer') {
        document.querySelectorAll('.tab')[0].classList.add('active');
      } else {
        document.querySelectorAll('.tab')[1].classList.add('active');
      }
    }

    async function handleLogin(type) {
      const idInput = document.getElementById(`${type}-id`);
      const pwInput = document.getElementById(`${type}-pw`);
      const errorMsg = document.getElementById(`${type}-error`);

      const idValue = idInput.value.trim();
      const pwValue = pwInput.value.trim();

      errorMsg.style.display = "none";

      if (!idValue) {
        errorMsg.textContent = "아이디를 입력해 주세요.";
        errorMsg.style.display = "block";
        return;
      }
      if (!pwValue) {
        errorMsg.textContent = "비밀번호를 입력해 주세요.";
        errorMsg.style.display = "block";
        return;
      }

      try {
        const response = await fetch("https://openmarket.weniv.co.kr/accounts/login/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            username: idValue,
            password: pwValue,
            login_type: type === 'buyer' ? 'BUYER' : 'SELLER'
          })
        });

        const data = await response.json();

        if (response.ok) {
          localStorage.setItem("token", data.token);
          alert("로그인 성공!")
          location.href = "index.html";
        } else {
          errorMsg.textContent = "아이디 또는 비밀번호가 일치하지 않습니다.";
          errorMsg.style.display = "block";
        }
      } catch (error) {
        console.error("에러 발생:", error);
        alert("서버 연결에 실패했습니다.")
      }
    }
  </script>

</body>
</html>
